;este archivo define una funcion delay usando el systick
SysTick_BASE	EQU		0xE000E010
STK_CTRL		EQU		0x00
STK_LOAD		EQU		0x04
STK_VAL			EQU		0X08
STK_CALIB		EQU		0x0C
	
STK_ENABLE		EQU		0x5
STK_DISABLE		EQU		0x0
STK_ENDCOUNT	EQU		0x1
			
			AREA delay_systick,CODE
			ALIGN

delay_ms	PROC
			;EXPORT	delay_ms
			;1FSRT->R0 = TIEMPO DE RETARDO EN MILISEGUNDOS
			LDR		R1,=SysTick_BASE
			LDR		R2,=15999					;SI EL RELOJ ESTA CONFIGURADO A 16mhz
			STR		R2,[R1,#STK_LOAD]			;SE ESTABLE EL VALOR DE AUTORECARGA
			MOV		R2,#0
			STR		R2,[R1,#STK_VAL]			;SE ESTABLECE EL VALOR DE CONTEO INCIAL
			LDR		R2,[R1,#STK_CTRL]			;SE CARGA EL CONTENIDO DEL REGISTRO
			ORR		R2,R2,#STK_ENABLE			;SE MODIFICA EL VALOR DE REGISTRO LEIDO
			STR		R2,[R1,#STK_CTRL]			;SE ACTIVA EL CONTEO
			;SE ESPERA HASTA QUE TERMINA EL CONTEO
			MOV		R2,#1						; i = 0
for			CMP		R2,R0						;i<tiempo
			BHI		endFor
			ADD		R2,R2,#1					;i++
while		LDR		R3,[R1,#STK_CTRL]
			LSR		R3,R3,#16					;R3>>16
			MOV		R4,#STK_ENDCOUNT
			CMP		R4,R3
			BNE		while
			B		for
endFor		MOV		R0,#STK_DISABLE
			LDR		R0,[R1,#STK_CTRL]
			BX		LR							;RETORNA LA FUNCION	
			ENDP
			ALIGN
			END